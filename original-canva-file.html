<!doctype html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blueprint Grid Builder</title>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="/_sdk/data_sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(50, 40px);
            grid-template-rows: repeat(40, 40px);
            gap: 0;
            background: #1a1a1a;
            border: 1px solid #444;
            position: relative;
        }

        .tile {
            width: 40px;
            height: 40px;
            border: 0.5px solid #2a2a2a;
            position: relative;
            cursor: pointer;
            transition: opacity 0.2s;
            background-size: cover !important;
            background-position: center !important;
        }

        .tile:hover {
            opacity: 0.8;
        }

        .wall-overlay {
            position: absolute;
            background: #E6E0D2;
            z-index: 10;
            pointer-events: none;
        }

        .wall-top,
        .wall-bottom {
            width: 100%;
            height: 3px;
            left: 0;
        }

        .wall-top {
            top: -1.5px;
        }

        .wall-bottom {
            bottom: -1.5px;
        }

        .wall-left,
        .wall-right {
            height: 100%;
            width: 3px;
            top: 0;
        }

        .wall-left {
            left: -1.5px;
        }

        .wall-right {
            right: -1.5px;
        }

        .wall-corner {
            position: absolute;
            width: 3px;
            height: 3px;
            background: inherit;
            z-index: 10;
            pointer-events: none;
        }

        .door-overlay {
            position: absolute;
            background: #8B6A45;
            z-index: 11;
            pointer-events: none;
        }

        .door-top,
        .door-bottom {
            width: 60%;
            height: 4px;
            left: 20%;
        }

        .door-top {
            top: -1px;
        }

        .door-bottom {
            bottom: -1px;
        }

        .door-left,
        .door-right {
            height: 60%;
            width: 4px;
            top: 20%;
        }

        .door-left {
            left: -1px;
        }

        .door-right {
            right: -1px;
        }

        .furniture-overlay {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 15;
            pointer-events: none;
            border: 2px solid rgba(0, 0, 0, 0.4);
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .furniture-within {
            border: 1px solid rgba(0, 0, 0, 0.3);
        }

        .furniture-svg {
            width: 100%;
            height: 100%;
        }

        .wall-shelf-overlay {
            position: absolute;
            z-index: 12;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .edge-button {
            position: absolute;
            background: rgba(100, 100, 100, 0.05);
            cursor: pointer;
            z-index: 20;
            transition: background 0.2s;
            display: none;
        }

        .edge-button.visible {
            display: block;
        }

        .edge-button:hover {
            background: rgba(100, 100, 100, 0.4);
        }

        .edge-top,
        .edge-bottom {
            width: 100%;
            height: 12px;
            left: 0;
        }

        .edge-top {
            top: -6px;
        }

        .edge-bottom {
            bottom: -6px;
        }

        .edge-left,
        .edge-right {
            height: 100%;
            width: 12px;
            top: 0;
        }

        .edge-left {
            left: -6px;
        }

        .edge-right {
            right: -6px;
        }

        .material-btn {
            padding: 6px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            font-size: 13px;
            text-align: center;
        }

        .material-btn:hover {
            border-color: rgba(255, 255, 255, 0.4);
        }

        .material-btn.active {
            border-width: 2px;
            border-color: rgba(255, 255, 255, 0.6);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 2px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .furniture-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
        }

        .furniture-btn {
            padding: 4px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
        }

        .room-preview {
            position: absolute;
            pointer-events: none;
            z-index: 100;
            border: 2px dashed rgba(230, 224, 210, 0.8);
            background: rgba(230, 224, 210, 0.1);
        }
    </style>
    <style>
        @view-transition {
            navigation: auto;
        }
    </style>
</head>

<body class="h-full m-0 p-0">
    <div class="h-full w-full flex flex-col bg-gray-900"><!-- Header -->
        <div class="bg-gray-800 border-b border-gray-700 p-3 flex items-center justify-between">
            <h1 id="project-title" class="text-2xl font-bold text-gray-100 flex-1 text-center">My Blueprint</h1>
            <div class="flex items-center gap-2 text-gray-300 text-sm"><span>Rotation:</span> <button id="rotate-btn"
                    class="material-btn" style="background: #4b5563; color: white; min-width: 80px;"> ⬆️ North </button>
            </div>
        </div><!-- Main Content -->
        <div class="flex-1 flex overflow-hidden"><!-- Sidebar -->
            <div class="w-56 bg-gray-800 border-r border-gray-700 p-3 overflow-y-auto">
                <h2 class="text-lg font-bold mb-3 text-gray-100">Tools</h2><!-- Mode Selection -->
                <div class="mb-4">
                    <h3 class="text-xs font-semibold mb-2 text-gray-400 uppercase">Mode</h3>
                    <div class="flex flex-col gap-1.5"><button id="mode-floor" class="material-btn active"
                            style="background: #4b5563; color: white;"> Floor </button> <button id="mode-wall"
                            class="material-btn" style="background: #4b5563; color: white;"> Walls </button> <button
                            id="mode-door" class="material-btn" style="background: #4b5563; color: white;"> Doors
                        </button> <button id="mode-furniture" class="material-btn"
                            style="background: #4b5563; color: white;"> Furniture </button> <button id="mode-rooms"
                            class="material-btn" style="background: #4b5563; color: white;"> Rooms </button> <button
                            id="mode-erase" class="material-btn" style="background: #7f1d1d; color: #fca5a5;"> Erase
                        </button> </div>
                </div><!-- Wall Type Selection -->
                <div id="wall-section" class="mb-4" style="display: none;">
                    <h3 class="text-xs font-semibold mb-2 text-gray-400 uppercase">Wall Types</h3>
                    <div class="flex flex-col gap-1.5"><button class="material-btn active" data-wall="standard"
                            style="background: #E6E0D2; color: #333;"> Standard </button> <button class="material-btn"
                            data-wall="picketFence" style="background: #c1c1af; color: #333;"> Picket Fence </button>
                        <button class="material-btn" data-wall="woodenFence" style="background: #553b24; color: white;">
                            Wood Fence </button> <button class="material-btn" data-wall="logWall"
                            style="background: #463827; color: white;"> Log Wall </button>
                    </div>
                </div><!-- Door Type Selection -->
                <div id="door-section" class="mb-4" style="display: none;">
                    <h3 class="text-xs font-semibold mb-2 text-gray-400 uppercase">Door Types</h3>
                    <div class="flex flex-col gap-1.5"><button class="material-btn active" data-door="standard"
                            style="background: #8B6A45; color: white;"> Standard </button> <button class="material-btn"
                            data-door="logGate" style="background: #463827; color: white;"> Log Gate </button> </div>
                </div><!-- Material Selection -->
                <div id="material-section" class="mb-4">
                    <h3 class="text-xs font-semibold mb-2 text-gray-400 uppercase">Materials</h3>
                    <div class="flex flex-col gap-1.5"><button class="material-btn active" data-material="sand"
                            style="background: #D8C58A; color: #333;"> Sand </button> <button class="material-btn"
                            data-material="hay" style="background: #CDB86A; color: #333;"> Hay </button> <button
                            class="material-btn" data-material="dirt" style="background: #8A6E3E; color: white;"> Dirt
                        </button> <button class="material-btn" data-material="grass"
                            style="background: #6F7E3B; color: white;"> Grass </button> <button class="material-btn"
                            data-material="concrete" style="background: #C9C6BC; color: #333;"> Concrete </button>
                        <button class="material-btn" data-material="wood" style="background: #A37C4A; color: white;">
                            Wood </button> <button class="material-btn" data-material="medical"
                            style="background: #F2F4F3; color: #333;"> Medical </button> <button class="material-btn"
                            data-material="bathroom" style="background: #D9E1E4; color: #333;"> Bathroom </button>
                        <button class="material-btn" data-material="kitchen" style="background: #E4DAC6; color: #333;">
                            Kitchen </button> <button class="material-btn" data-material="water"
                            style="background: #4A90E2; color: white;"> Water </button> <button class="material-btn"
                            data-material="concreteBlock" style="background: #bcb9b3; color: #333;"> Concrete Block
                        </button> <button class="material-btn" data-material="parkingLot"
                            style="background: #84807a; color: white;"> Parking Lot </button> <button
                            class="material-btn" data-material="asphalt" style="background: #656565; color: white;">
                            Asphalt </button> <button class="material-btn" data-material="brick"
                            style="background: #73574b; color: white;"> Brick </button>
                    </div>
                </div><!-- Furniture Selection -->
                <div id="furniture-section" class="mb-4" style="display: none;">
                    <h3 class="text-xs font-semibold mb-2 text-gray-400 uppercase">Furniture</h3>
                    <div class="furniture-grid"><button class="material-btn furniture-btn active" data-furniture="bed"
                            style="background: #4b5563; color: white;">Bed</button> <button
                            class="material-btn furniture-btn" data-furniture="medicalBed"
                            style="background: #4b5563; color: white;">Med Bed</button> <button
                            class="material-btn furniture-btn" data-furniture="chair"
                            style="background: #4b5563; color: white;">Chair</button> <button
                            class="material-btn furniture-btn" data-furniture="deskChair"
                            style="background: #4b5563; color: white;">Desk Ch.</button> <button
                            class="material-btn furniture-btn" data-furniture="desk"
                            style="background: #4b5563; color: white;">Desk</button> <button
                            class="material-btn furniture-btn" data-furniture="computer"
                            style="background: #4b5563; color: white;">Computer</button> <button
                            class="material-btn furniture-btn" data-furniture="fileCabinet"
                            style="background: #4b5563; color: white;">Cabinet</button> <button
                            class="material-btn furniture-btn" data-furniture="sink"
                            style="background: #4b5563; color: white;">Sink</button> <button
                            class="material-btn furniture-btn" data-furniture="steelCounter"
                            style="background: #4b5563; color: white;">Steel Ctr</button> <button
                            class="material-btn furniture-btn" data-furniture="woodCounter"
                            style="background: #4b5563; color: white;">Wood Ctr</button> <button
                            class="material-btn furniture-btn" data-furniture="medicalCounter"
                            style="background: #4b5563; color: white;">Med Ctr</button> <button
                            class="material-btn furniture-btn" data-furniture="miniFridge"
                            style="background: #4b5563; color: white;">M. Fridge</button> <button
                            class="material-btn furniture-btn" data-furniture="largeFridge"
                            style="background: #4b5563; color: white;">L. Fridge</button> <button
                            class="material-btn furniture-btn" data-furniture="stove"
                            style="background: #4b5563; color: white;">Stove</button> <button
                            class="material-btn furniture-btn" data-furniture="oldOven"
                            style="background: #4b5563; color: white;">Old Oven</button> <button
                            class="material-btn furniture-btn" data-furniture="washer"
                            style="background: #4b5563; color: white;">Washer</button> <button
                            class="material-btn furniture-btn" data-furniture="dryer"
                            style="background: #4b5563; color: white;">Dryer</button> <button
                            class="material-btn furniture-btn" data-furniture="poolTable"
                            style="background: #4b5563; color: white;">Pool Tbl</button> <button
                            class="material-btn furniture-btn" data-furniture="jukebox"
                            style="background: #4b5563; color: white;">Jukebox</button> <button
                            class="material-btn furniture-btn" data-furniture="medicalTray"
                            style="background: #4b5563; color: white;">Med Tray</button> <button
                            class="material-btn furniture-btn" data-furniture="ivStand"
                            style="background: #4b5563; color: white;">IV Stand</button> <button
                            class="material-btn furniture-btn" data-furniture="storageBox"
                            style="background: #4b5563; color: white;">Storage</button> <button
                            class="material-btn furniture-btn" data-furniture="shelf"
                            style="background: #4b5563; color: white;">Shelf</button> <button
                            class="material-btn furniture-btn" data-furniture="wallShelf"
                            style="background: #4b5563; color: white;">Wall Shf</button> <button
                            class="material-btn furniture-btn" data-furniture="trashcan"
                            style="background: #4b5563; color: white;">Trash</button> <button
                            class="material-btn furniture-btn" data-furniture="waterBarrel"
                            style="background: #4b5563; color: white;">W. Barrel</button> <button
                            class="material-btn furniture-btn" data-furniture="schoolLockers"
                            style="background: #4b5563; color: white;">Lockers</button> <button
                            class="material-btn furniture-btn" data-furniture="waterTank"
                            style="background: #4b5563; color: white;">W. Tank</button> <button
                            class="material-btn furniture-btn" data-furniture="bathroomSink"
                            style="background: #4b5563; color: white;">Bath Sink</button> <button
                            class="material-btn furniture-btn" data-furniture="bathroomCounter"
                            style="background: #4b5563; color: white;">Bath Ctr</button> <button
                            class="material-btn furniture-btn" data-furniture="toilet"
                            style="background: #4b5563; color: white;">Toilet</button> <button
                            class="material-btn furniture-btn" data-furniture="stallWall"
                            style="background: #4b5563; color: white;">Stall Wall</button> <button
                            class="material-btn furniture-btn" data-furniture="shower"
                            style="background: #4b5563; color: white;">Shower</button> </div>
                </div><!-- Actions -->
                <div class="mt-4"><button id="clear-all" class="material-btn w-full"
                        style="background: #7f1d1d; color: #fca5a5;"> Clear </button> </div>
            </div><!-- Grid Area -->
            <div id="grid-viewport" class="flex-1 p-8 overflow-auto flex items-center justify-center"
                style="position: relative;">
                <div id="grid-wrapper" style="transform-origin: center; transition: transform 0.1s;">
                    <div id="grid" class="grid-container"></div>
                </div>
                <div style="position: fixed; bottom: 16px; right: 16px; display: flex; gap: 8px; z-index: 100;"><button
                        id="zoom-out" class="material-btn"
                        style="background: #4b5563; color: white; padding: 8px 12px;">−</button> <button id="zoom-reset"
                        class="material-btn"
                        style="background: #4b5563; color: white; padding: 8px 12px; font-size: 11px;">100%</button>
                    <button id="zoom-in" class="material-btn"
                        style="background: #4b5563; color: white; padding: 8px 12px;">+</button> <button id="toggle-ui"
                        class="material-btn"
                        style="background: #4b5563; color: white; padding: 8px 12px;">����️</button>
                </div>
            </div><!-- Legend -->
            <div class="w-48 bg-gray-800 border-l border-gray-700 p-3 overflow-y-auto">
                <h2 class="text-lg font-bold mb-3 text-gray-100">Info</h2>
                <div id="selected-info" class="mb-4 p-2 bg-gray-700 rounded text-xs text-gray-300">
                    <div class="font-semibold mb-1"> Selected: </div>
                    <div id="selected-name"> Sand Floor </div>
                </div>
                <h3 class="text-sm font-bold mb-2 text-gray-100">Legend</h3>
                <div class="flex flex-col gap-1.5">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #E6E0D2;"></div><span
                            class="text-xs text-gray-300">Walls</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8B6A45;"></div><span
                            class="text-xs text-gray-300">Doors</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #D8C58A;"></div><span
                            class="text-xs text-gray-300">Sand</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #CDB86A;"></div><span
                            class="text-xs text-gray-300">Hay</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8A6E3E;"></div><span
                            class="text-xs text-gray-300">Dirt</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #6F7E3B;"></div><span
                            class="text-xs text-gray-300">Grass</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #C9C6BC;"></div><span
                            class="text-xs text-gray-300">Concrete</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #A37C4A;"></div><span
                            class="text-xs text-gray-300">Wood</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script> const MATERIALS = { sand: '#D8C58A', hay: '#CDB86A', dirt: '#8A6E3E', grass: '#6F7E3B', concrete: '#C9C6BC', wood: '#A37C4A', medical: '#F2F4F3', bathroom: '#D9E1E4', kitchen: '#E4DAC6', water: '#4A90E2', concreteBlock: '#bcb9b3', parkingLot: '#84807a', asphalt: '#656565', brick: '#73574b' }; function createFloorTexture(material, row, col) { const canvas = document.createElement('canvas'); canvas.width = 40; canvas.height = 40; const ctx = canvas.getContext('2d'); const baseColor = MATERIALS[material]; ctx.fillStyle = baseColor; ctx.fillRect(0, 0, 40, 40); const random = (seed) => { const x = Math.sin(seed) * 10000; return x - Math.floor(x); }; const seed = row * 1000 + col; if (material === 'sand') { for (let i = 0; i < 30; i++) { const x = random(seed + i * 7) * 40; const y = random(seed + i * 11) * 40; const size = random(seed + i * 13) * 2 + 0.5; ctx.fillStyle = `rgba(${200 + random(seed + i * 17) * 20}, ${180 + random(seed + i * 19) * 20}, ${120 + random(seed + i * 23) * 20}, 0.3)`; ctx.fillRect(x, y, size, size); } } else if (material === 'grass') { for (let i = 0; i < 50; i++) { const x = random(seed + i * 7) * 40; const y = random(seed + i * 11) * 40; const length = random(seed + i * 13) * 4 + 2; const angle = random(seed + i * 17) * Math.PI * 2; ctx.strokeStyle = `rgba(${90 + random(seed + i * 19) * 30}, ${100 + random(seed + i * 23) * 30}, ${40 + random(seed + i * 29) * 20}, 0.4)`; ctx.lineWidth = 0.5; ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x + Math.cos(angle) * length, y + Math.sin(angle) * length); ctx.stroke(); } } else if (material === 'dirt') { for (let i = 0; i < 40; i++) { const x = random(seed + i * 7) * 40; const y = random(seed + i * 11) * 40; const size = random(seed + i * 13) * 3 + 1; ctx.fillStyle = `rgba(${100 + random(seed + i * 17) * 40}, ${80 + random(seed + i * 19) * 30}, ${40 + random(seed + i * 23) * 20}, 0.3)`; ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI * 2); ctx.fill(); } } else if (material === 'hay') { for (let i = 0; i < 25; i++) { const x = random(seed + i * 7) * 40; const y = random(seed + i * 11) * 40; const length = random(seed + i * 13) * 8 + 3; const angle = random(seed + i * 17) * Math.PI * 2; ctx.strokeStyle = `rgba(${190 + random(seed + i * 19) * 30}, ${170 + random(seed + i * 23) * 30}, ${80 + random(seed + i * 29) * 30}, 0.5)`; ctx.lineWidth = 1; ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x + Math.cos(angle) * length, y + Math.sin(angle) * length); ctx.stroke(); } } else if (material === 'water') { const gradient = ctx.createLinearGradient(0, 0, 40, 40); gradient.addColorStop(0, '#5AA3E8'); gradient.addColorStop(0.5, '#4A90E2'); gradient.addColorStop(1, '#3A7DC2'); ctx.fillStyle = gradient; ctx.fillRect(0, 0, 40, 40); for (let i = 0; i < 5; i++) { const x = random(seed + i * 7) * 40; const y = random(seed + i * 11) * 40; const radius = random(seed + i * 13) * 8 + 4; ctx.strokeStyle = `rgba(255, 255, 255, 0.15)`; ctx.lineWidth = 1; ctx.beginPath(); ctx.arc(x, y, radius, 0, Math.PI * 2); ctx.stroke(); } } else if (material === 'wood') { for (let i = 0; i < 8; i++) { const y = i * 5; ctx.strokeStyle = `rgba(${120 + random(seed + i * 7) * 40}, ${90 + random(seed + i * 11) * 30}, ${50 + random(seed + i * 13) * 20}, 0.3)`; ctx.lineWidth = random(seed + i * 17) * 2 + 1; ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(40, y + random(seed + i * 19) * 4 - 2); ctx.stroke(); } } else if (material === 'concrete') { for (let i = 0; i < 50; i++) { const x = random(seed + i * 7) * 40; const y = random(seed + i * 11) * 40; const size = random(seed + i * 13) * 1.5; ctx.fillStyle = `rgba(${180 + random(seed + i * 17) * 40}, ${180 + random(seed + i * 19) * 40}, ${170 + random(seed + i * 23) * 40}, 0.2)`; ctx.fillRect(x, y, size, size); } } else if (material === 'concreteBlock') { ctx.strokeStyle = '#a8a5a0'; ctx.lineWidth = 2; ctx.strokeRect(2, 2, 36, 36); for (let i = 0; i < 20; i++) { const x = random(seed + i * 7) * 36 + 2; const y = random(seed + i * 11) * 36 + 2; const size = random(seed + i * 13) * 2; ctx.fillStyle = `rgba(${170 + random(seed + i * 17) * 30}, ${165 + random(seed + i * 19) * 30}, ${160 + random(seed + i * 23) * 30}, 0.3)`; ctx.fillRect(x, y, size, size); } } else if (material === 'parkingLot') { for (let i = 0; i < 60; i++) { const x = random(seed + i * 7) * 40; const y = random(seed + i * 11) * 40; const size = random(seed + i * 13) * 2 + 0.5; ctx.fillStyle = `rgba(${110 + random(seed + i * 17) * 40}, ${105 + random(seed + i * 19) * 40}, ${100 + random(seed + i * 23) * 40}, 0.3)`; ctx.fillRect(x, y, size, size); } } else if (material === 'asphalt') { for (let i = 0; i < 70; i++) { const x = random(seed + i * 7) * 40; const y = random(seed + i * 11) * 40; const size = random(seed + i * 13) * 1.5 + 0.5; ctx.fillStyle = `rgba(${80 + random(seed + i * 17) * 40}, ${80 + random(seed + i * 19) * 40}, ${80 + random(seed + i * 23) * 40}, 0.3)`; ctx.fillRect(x, y, size, size); } } else if (material === 'medical') { ctx.strokeStyle = '#e8eae9'; ctx.lineWidth = 1; ctx.strokeRect(1, 1, 38, 38); for (let i = 0; i < 10; i++) { const x = random(seed + i * 7) * 36 + 2; const y = random(seed + i * 11) * 36 + 2; ctx.fillStyle = `rgba(235, 240, 238, 0.3)`; ctx.fillRect(x, y, 2, 2); } } else if (material === 'bathroom') { ctx.strokeStyle = '#c5d3d8'; ctx.lineWidth = 1; ctx.strokeRect(1, 1, 38, 38); for (let i = 0; i < 8; i++) { const x = random(seed + i * 7) * 36 + 2; const y = random(seed + i * 11) * 36 + 2; ctx.fillStyle = `rgba(205, 220, 228, 0.3)`; ctx.fillRect(x, y, 3, 3); } } else if (material === 'kitchen') { for (let i = 0; i < 15; i++) { const x = random(seed + i * 7) * 36 + 2; const y = random(seed + i * 11) * 36 + 2; const size = random(seed + i * 13) * 2 + 1; ctx.fillStyle = `rgba(${215 + random(seed + i * 17) * 20}, ${205 + random(seed + i * 19) * 20}, ${185 + random(seed + i * 23) * 20}, 0.3)`; ctx.fillRect(x, y, size, size); } } return canvas.toDataURL(); } const FURNITURE = { bed: { name: 'Bed', size: [1, 2], color: '#8B7355', wallMount: false }, medicalBed: { name: 'Medical Bed', size: [1, 2], color: '#E8E8E8', wallMount: false }, chair: { name: 'Chair', size: [1, 1], color: '#654321', wallMount: false }, deskChair: { name: 'Desk Chair', size: [1, 1], color: '#2C3E50', wallMount: false }, desk: { name: 'Desk', size: [2, 1], color: '#8B4513', wallMount: false }, computer: { name: 'CRT Computer', size: [1, 1], color: '#C0C0C0', wallMount: false, within: true }, fileCabinet: { name: 'File Cabinet', size: [1, 1], color: '#708090', wallMount: false, within: true }, sink: { name: 'Sink', size: [1, 1], color: '#B0C4DE', wallMount: true, within: true }, steelCounter: { name: 'Steel Counter', size: [1, 1], color: '#A9A9A9', wallMount: true, within: true }, woodCounter: { name: 'Wood Counter', size: [1, 1], color: '#8B7355', wallMount: true, within: true }, medicalCounter: { name: 'Medical Counter', size: [1, 1], color: '#E8E8E8', wallMount: true, within: true }, miniFridge: { name: 'Mini Fridge', size: [1, 1], color: '#4682B4', wallMount: true, within: true }, largeFridge: { name: 'Large Fridge', size: [1, 1], color: '#708090', wallMount: true, within: true }, stove: { name: 'Stove/Oven', size: [1, 1], color: '#2F4F4F', wallMount: true, within: true }, oldOven: { name: 'Old Oven', size: [1, 1], color: '#8B4513', wallMount: true, within: true }, washer: { name: 'Washing Machine', size: [1, 1], color: '#4682B4', wallMount: true, within: true }, dryer: { name: 'Dryer', size: [1, 1], color: '#696969', wallMount: true, within: true }, poolTable: { name: 'Pool Table', size: [1, 2], color: '#228B22', wallMount: false }, jukebox: { name: 'Jukebox', size: [1, 1], color: '#FF6347', wallMount: false }, medicalTray: { name: 'Medical Tray', size: [1, 1], color: '#C0C0C0', wallMount: false, within: true }, ivStand: { name: 'IV Stand', size: [1, 1], color: '#A9A9A9', wallMount: false, within: true }, storageBox: { name: 'Storage Box', size: [1, 1], color: '#8B7355', wallMount: false }, shelf: { name: 'Open Shelf', size: [1, 1], color: '#654321', wallMount: false }, wallShelf: { name: 'Wall Shelf', size: [1, 1], color: '#8B4513', wallMount: 'wall-only' }, trashcan: { name: 'Trash Can', size: [1, 1], color: '#4A4A4A', wallMount: false, within: true }, waterBarrel: { name: 'Water Barrel', size: [1, 1], color: '#8B6F47', wallMount: false, within: true }, schoolLockers: { name: 'School Lockers', size: [1, 1], color: '#2f487b', wallMount: 'wall-only' }, waterTank: { name: 'Water Tank', size: [1, 1], color: '#4682B4', wallMount: false, within: true }, bathroomSink: { name: 'Bathroom Sink', size: [1, 1], color: '#FFFFFF', wallMount: false, within: true }, bathroomCounter: { name: 'Bathroom Counter', size: [1, 1], color: '#D4D4D4', wallMount: false, within: true }, toilet: { name: 'Toilet', size: [1, 1], color: '#FFFFFF', wallMount: false, within: true }, stallWall: { name: 'Stall Wall', size: [1, 1], color: '#5e6183', wallMount: false }, shower: { name: 'Shower', size: [1, 1], color: '#C0C0C0', wallMount: false, within: true } }; function adjustColor(color, amount) { const num = parseInt(color.replace("#", ""), 16); const r = Math.max(0, Math.min(255, (num >> 16) + amount)); const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount)); const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount)); return "#" + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0'); } function createFurnitureSVG(type, width, height, color) { const svgNS = "http://www.w3.org/2000/svg"; const svg = document.createElementNS(svgNS, "svg"); svg.setAttribute("width", "100%"); svg.setAttribute("height", "100%"); svg.setAttribute("viewBox", `0 0 ${width * 40} ${height * 40}`); const darkerColor = adjustColor(color, -20); const lighterColor = adjustColor(color, 20); if (type === 'bed' || type === 'medicalBed') { const rect = document.createElementNS(svgNS, "rect"); rect.setAttribute("x", "2"); rect.setAttribute("y", "2"); rect.setAttribute("width", width * 40 - 4); rect.setAttribute("height", height * 40 - 4); rect.setAttribute("fill", color); rect.setAttribute("stroke", darkerColor); rect.setAttribute("stroke-width", "2"); svg.appendChild(rect); const pillow = document.createElementNS(svgNS, "rect"); pillow.setAttribute("x", "6"); pillow.setAttribute("y", "6"); pillow.setAttribute("width", width * 40 - 12); pillow.setAttribute("height", "20"); pillow.setAttribute("fill", lighterColor); pillow.setAttribute("stroke", darkerColor); pillow.setAttribute("stroke-width", "1"); svg.appendChild(pillow); if (type === 'medicalBed') { const crossV = document.createElementNS(svgNS, "rect"); crossV.setAttribute("x", width * 20 - 2); crossV.setAttribute("y", height * 40 - 30); crossV.setAttribute("width", "4"); crossV.setAttribute("height", "16"); crossV.setAttribute("fill", "#FF0000"); svg.appendChild(crossV); const crossH = document.createElementNS(svgNS, "rect"); crossH.setAttribute("x", width * 20 - 8); crossH.setAttribute("y", height * 40 - 24); crossH.setAttribute("width", "16"); crossH.setAttribute("height", "4"); crossH.setAttribute("fill", "#FF0000"); svg.appendChild(crossH); } } else if (type === 'chair' || type === 'deskChair') { const seat = document.createElementNS(svgNS, "rect"); seat.setAttribute("x", "8"); seat.setAttribute("y", "20"); seat.setAttribute("width", "24"); seat.setAttribute("height", "12"); seat.setAttribute("fill", color); seat.setAttribute("stroke", darkerColor); seat.setAttribute("stroke-width", "2"); svg.appendChild(seat); const back = document.createElementNS(svgNS, "rect"); back.setAttribute("x", "10"); back.setAttribute("y", "6"); back.setAttribute("width", "20"); back.setAttribute("height", "16"); back.setAttribute("fill", lighterColor); back.setAttribute("stroke", darkerColor); back.setAttribute("stroke-width", "2"); svg.appendChild(back); if (type === 'deskChair') { const wheel1 = document.createElementNS(svgNS, "circle"); wheel1.setAttribute("cx", "14"); wheel1.setAttribute("cy", "34"); wheel1.setAttribute("r", "3"); wheel1.setAttribute("fill", "#333"); svg.appendChild(wheel1); const wheel2 = document.createElementNS(svgNS, "circle"); wheel2.setAttribute("cx", "26"); wheel2.setAttribute("cy", "34"); wheel2.setAttribute("r", "3"); wheel2.setAttribute("fill", "#333"); svg.appendChild(wheel2); } } else if (type === 'desk') { const desktop = document.createElementNS(svgNS, "rect"); desktop.setAttribute("x", "2"); desktop.setAttribute("y", "2"); desktop.setAttribute("width", width * 40 - 4); desktop.setAttribute("height", height * 40 - 4); desktop.setAttribute("fill", color); desktop.setAttribute("stroke", darkerColor); desktop.setAttribute("stroke-width", "2"); svg.appendChild(desktop); const drawer = document.createElementNS(svgNS, "rect"); drawer.setAttribute("x", "10"); drawer.setAttribute("y", "12"); drawer.setAttribute("width", "20"); drawer.setAttribute("height", "12"); drawer.setAttribute("fill", darkerColor); drawer.setAttribute("stroke", "#000"); drawer.setAttribute("stroke-width", "1"); svg.appendChild(drawer); const handle = document.createElementNS(svgNS, "rect"); handle.setAttribute("x", "18"); handle.setAttribute("y", "17"); handle.setAttribute("width", "4"); handle.setAttribute("height", "2"); handle.setAttribute("fill", "#333"); svg.appendChild(handle); } else if (type === 'computer') { const monitor = document.createElementNS(svgNS, "rect"); monitor.setAttribute("x", "8"); monitor.setAttribute("y", "8"); monitor.setAttribute("width", "24"); monitor.setAttribute("height", "18"); monitor.setAttribute("fill", color); monitor.setAttribute("stroke", darkerColor); monitor.setAttribute("stroke-width", "2"); svg.appendChild(monitor); const screen = document.createElementNS(svgNS, "rect"); screen.setAttribute("x", "11"); screen.setAttribute("y", "11"); screen.setAttribute("width", "18"); screen.setAttribute("height", "12"); screen.setAttribute("fill", "#003300"); svg.appendChild(screen); const base = document.createElementNS(svgNS, "rect"); base.setAttribute("x", "15"); base.setAttribute("y", "27"); base.setAttribute("width", "10"); base.setAttribute("height", "6"); base.setAttribute("fill", darkerColor); svg.appendChild(base); } else if (type === 'fileCabinet') { const body = document.createElementNS(svgNS, "rect"); body.setAttribute("x", "10"); body.setAttribute("y", "10"); body.setAttribute("width", "20"); body.setAttribute("height", "25"); body.setAttribute("fill", color); body.setAttribute("stroke", darkerColor); body.setAttribute("stroke-width", "2"); svg.appendChild(body); for (let i = 0; i < 3; i++) { const drawer = document.createElementNS(svgNS, "rect"); drawer.setAttribute("x", "12"); drawer.setAttribute("y", 12 + i * 7); drawer.setAttribute("width", "16"); drawer.setAttribute("height", "6"); drawer.setAttribute("fill", darkerColor); drawer.setAttribute("stroke", "#000"); drawer.setAttribute("stroke-width", "1"); svg.appendChild(drawer); const handle = document.createElementNS(svgNS, "circle"); handle.setAttribute("cx", "20"); handle.setAttribute("cy", 15 + i * 7); handle.setAttribute("r", "1.5"); handle.setAttribute("fill", "#666"); svg.appendChild(handle); } } else if (type === 'sink') { const basin = document.createElementNS(svgNS, "ellipse"); basin.setAttribute("cx", "20"); basin.setAttribute("cy", "22"); basin.setAttribute("rx", "12"); basin.setAttribute("ry", "8"); basin.setAttribute("fill", lighterColor); basin.setAttribute("stroke", darkerColor); basin.setAttribute("stroke-width", "2"); svg.appendChild(basin); const faucet = document.createElementNS(svgNS, "path"); faucet.setAttribute("d", "M 20 10 L 20 16 L 24 16"); faucet.setAttribute("stroke", "#888"); faucet.setAttribute("stroke-width", "3"); faucet.setAttribute("fill", "none"); svg.appendChild(faucet); } else if (type === 'steelCounter' || type === 'woodCounter' || type === 'medicalCounter') { const counter = document.createElementNS(svgNS, "rect"); counter.setAttribute("x", "4"); counter.setAttribute("y", "4"); counter.setAttribute("width", "32"); counter.setAttribute("height", "32"); counter.setAttribute("fill", color); counter.setAttribute("stroke", darkerColor); counter.setAttribute("stroke-width", "2"); svg.appendChild(counter); const detail = document.createElementNS(svgNS, "rect"); detail.setAttribute("x", "7"); detail.setAttribute("y", "7"); detail.setAttribute("width", "26"); detail.setAttribute("height", "4"); detail.setAttribute("fill", lighterColor); svg.appendChild(detail); } else if (type === 'miniFridge' || type === 'largeFridge') { const body = document.createElementNS(svgNS, "rect"); body.setAttribute("x", "8"); body.setAttribute("y", type === 'miniFridge' ? "15" : "5"); body.setAttribute("width", "24"); body.setAttribute("height", type === 'miniFridge' ? "20" : "30"); body.setAttribute("fill", color); body.setAttribute("stroke", darkerColor); body.setAttribute("stroke-width", "2"); svg.appendChild(body); const handle = document.createElementNS(svgNS, "rect"); handle.setAttribute("x", "28"); handle.setAttribute("y", type === 'miniFridge' ? "22" : "18"); handle.setAttribute("width", "2"); handle.setAttribute("height", "8"); handle.setAttribute("fill", "#333"); svg.appendChild(handle); } else if (type === 'stove' || type === 'oldOven') { const body = document.createElementNS(svgNS, "rect"); body.setAttribute("x", "6"); body.setAttribute("y", "6"); body.setAttribute("width", "28"); body.setAttribute("height", "28"); body.setAttribute("fill", color); body.setAttribute("stroke", darkerColor); body.setAttribute("stroke-width", "2"); svg.appendChild(body); const burner1 = document.createElementNS(svgNS, "circle"); burner1.setAttribute("cx", "15"); burner1.setAttribute("cy", "15"); burner1.setAttribute("r", "5"); burner1.setAttribute("fill", "#333"); svg.appendChild(burner1); const burner2 = document.createElementNS(svgNS, "circle"); burner2.setAttribute("cx", "25"); burner2.setAttribute("cy", "15"); burner2.setAttribute("r", "5"); burner2.setAttribute("fill", "#333"); svg.appendChild(burner2); } else if (type === 'washer' || type === 'dryer') { const body = document.createElementNS(svgNS, "rect"); body.setAttribute("x", "8"); body.setAttribute("y", "8"); body.setAttribute("width", "24"); body.setAttribute("height", "28"); body.setAttribute("fill", color); body.setAttribute("stroke", darkerColor); body.setAttribute("stroke-width", "2"); svg.appendChild(body); const door = document.createElementNS(svgNS, "circle"); door.setAttribute("cx", "20"); door.setAttribute("cy", "22"); door.setAttribute("r", "8"); door.setAttribute("fill", lighterColor); door.setAttribute("stroke", darkerColor); door.setAttribute("stroke-width", "2"); svg.appendChild(door); const innerCircle = document.createElementNS(svgNS, "circle"); innerCircle.setAttribute("cx", "20"); innerCircle.setAttribute("cy", "22"); innerCircle.setAttribute("r", "5"); innerCircle.setAttribute("fill", "none"); innerCircle.setAttribute("stroke", darkerColor); innerCircle.setAttribute("stroke-width", "1"); svg.appendChild(innerCircle); } else if (type === 'poolTable') { const surface = document.createElementNS(svgNS, "rect"); surface.setAttribute("x", "2"); surface.setAttribute("y", "2"); surface.setAttribute("width", width * 40 - 4); surface.setAttribute("height", height * 40 - 4); surface.setAttribute("fill", color); surface.setAttribute("stroke", darkerColor); surface.setAttribute("stroke-width", "3"); svg.appendChild(surface);[8, 32].forEach(y => { [8, width * 20, width * 40 - 8].forEach(x => { const pocket = document.createElementNS(svgNS, "circle"); pocket.setAttribute("cx", x); pocket.setAttribute("cy", y); pocket.setAttribute("r", "4"); pocket.setAttribute("fill", "#000"); svg.appendChild(pocket); }); }); } else if (type === 'jukebox') { const body = document.createElementNS(svgNS, "rect"); body.setAttribute("x", "6"); body.setAttribute("y", "5"); body.setAttribute("width", "28"); body.setAttribute("height", "32"); body.setAttribute("fill", color); body.setAttribute("stroke", darkerColor); body.setAttribute("stroke-width", "2"); body.setAttribute("rx", "4"); svg.appendChild(body); const display = document.createElementNS(svgNS, "rect"); display.setAttribute("x", "10"); display.setAttribute("y", "10"); display.setAttribute("width", "20"); display.setAttribute("height", "12"); display.setAttribute("fill", "#FFD700"); display.setAttribute("stroke", "#000"); display.setAttribute("stroke-width", "1"); svg.appendChild(display); for (let i = 0; i < 3; i++) { const btn = document.createElementNS(svgNS, "circle"); btn.setAttribute("cx", 14 + i * 6); btn.setAttribute("cy", "28"); btn.setAttribute("r", "2"); btn.setAttribute("fill", "#FFD700"); svg.appendChild(btn); } } else if (type === 'medicalTray') { const tray = document.createElementNS(svgNS, "rect"); tray.setAttribute("x", "10"); tray.setAttribute("y", "8"); tray.setAttribute("width", "20"); tray.setAttribute("height", "12"); tray.setAttribute("fill", color); tray.setAttribute("stroke", darkerColor); tray.setAttribute("stroke-width", "2"); svg.appendChild(tray); const pole = document.createElementNS(svgNS, "rect"); pole.setAttribute("x", "19"); pole.setAttribute("y", "20"); pole.setAttribute("width", "2"); pole.setAttribute("height", "12"); pole.setAttribute("fill", darkerColor); svg.appendChild(pole); const base = document.createElementNS(svgNS, "ellipse"); base.setAttribute("cx", "20"); base.setAttribute("cy", "33"); base.setAttribute("rx", "6"); base.setAttribute("ry", "3"); base.setAttribute("fill", darkerColor); svg.appendChild(base); } else if (type === 'ivStand') { const pole = document.createElementNS(svgNS, "rect"); pole.setAttribute("x", "19"); pole.setAttribute("y", "5"); pole.setAttribute("width", "2"); pole.setAttribute("height", "28"); pole.setAttribute("fill", color); svg.appendChild(pole); const hook = document.createElementNS(svgNS, "path"); hook.setAttribute("d", "M 20 8 L 26 8 L 26 12"); hook.setAttribute("stroke", color); hook.setAttribute("stroke-width", "2"); hook.setAttribute("fill", "none"); svg.appendChild(hook); const bag = document.createElementNS(svgNS, "rect"); bag.setAttribute("x", "24"); bag.setAttribute("y", "12"); bag.setAttribute("width", "6"); bag.setAttribute("height", "8"); bag.setAttribute("fill", lighterColor); bag.setAttribute("stroke", darkerColor); bag.setAttribute("stroke-width", "1"); svg.appendChild(bag); const base = document.createElementNS(svgNS, "circle"); base.setAttribute("cx", "20"); base.setAttribute("cy", "35"); base.setAttribute("r", "5"); base.setAttribute("fill", darkerColor); svg.appendChild(base); } else if (type === 'storageBox') { const box = document.createElementNS(svgNS, "rect"); box.setAttribute("x", "4"); box.setAttribute("y", "8"); box.setAttribute("width", "32"); box.setAttribute("height", "28"); box.setAttribute("fill", color); box.setAttribute("stroke", darkerColor); box.setAttribute("stroke-width", "2"); svg.appendChild(box); const lid = document.createElementNS(svgNS, "line"); lid.setAttribute("x1", "4"); lid.setAttribute("y1", "18"); lid.setAttribute("x2", "36"); lid.setAttribute("y2", "18"); lid.setAttribute("stroke", darkerColor); lid.setAttribute("stroke-width", "2"); svg.appendChild(lid); const lock = document.createElementNS(svgNS, "rect"); lock.setAttribute("x", "18"); lock.setAttribute("y", "16"); lock.setAttribute("width", "4"); lock.setAttribute("height", "4"); lock.setAttribute("fill", "#333"); svg.appendChild(lock); } else if (type === 'shelf') { const frame = document.createElementNS(svgNS, "rect"); frame.setAttribute("x", "4"); frame.setAttribute("y", "4"); frame.setAttribute("width", "32"); frame.setAttribute("height", "32"); frame.setAttribute("fill", "none"); frame.setAttribute("stroke", darkerColor); frame.setAttribute("stroke-width", "2"); svg.appendChild(frame); for (let i = 1; i <= 2; i++) { const shelf = document.createElementNS(svgNS, "rect"); shelf.setAttribute("x", "4"); shelf.setAttribute("y", 4 + i * 10); shelf.setAttribute("width", "32"); shelf.setAttribute("height", "2"); shelf.setAttribute("fill", color); svg.appendChild(shelf); } } else if (type === 'trashcan') { const body = document.createElementNS(svgNS, "path"); body.setAttribute("d", "M 12 14 L 10 34 L 30 34 L 28 14 Z"); body.setAttribute("fill", color); body.setAttribute("stroke", darkerColor); body.setAttribute("stroke-width", "2"); svg.appendChild(body); const lid = document.createElementNS(svgNS, "rect"); lid.setAttribute("x", "8"); lid.setAttribute("y", "10"); lid.setAttribute("width", "24"); lid.setAttribute("height", "4"); lid.setAttribute("fill", darkerColor); lid.setAttribute("rx", "2"); svg.appendChild(lid); const handle = document.createElementNS(svgNS, "rect"); handle.setAttribute("x", "16"); handle.setAttribute("y", "6"); handle.setAttribute("width", "8"); handle.setAttribute("height", "6"); handle.setAttribute("fill", "none"); handle.setAttribute("stroke", darkerColor); handle.setAttribute("stroke-width", "2"); handle.setAttribute("rx", "3"); svg.appendChild(handle); } else if (type === 'waterBarrel') { const barrel = document.createElementNS(svgNS, "ellipse"); barrel.setAttribute("cx", "20"); barrel.setAttribute("cy", "22"); barrel.setAttribute("rx", "12"); barrel.setAttribute("ry", "14"); barrel.setAttribute("fill", color); barrel.setAttribute("stroke", darkerColor); barrel.setAttribute("stroke-width", "2"); svg.appendChild(barrel); const water = document.createElementNS(svgNS, "ellipse"); water.setAttribute("cx", "20"); water.setAttribute("cy", "16"); water.setAttribute("rx", "10"); water.setAttribute("ry", "4"); water.setAttribute("fill", "#4A90E2"); water.setAttribute("opacity", "0.7"); svg.appendChild(water); for (let i = 0; i < 3; i++) { const band = document.createElementNS(svgNS, "ellipse"); band.setAttribute("cx", "20"); band.setAttribute("cy", 12 + i * 8); band.setAttribute("rx", "12"); band.setAttribute("ry", "1"); band.setAttribute("fill", darkerColor); svg.appendChild(band); } } else if (type === 'schoolLockers') { const locker1 = document.createElementNS(svgNS, "rect"); locker1.setAttribute("x", "4"); locker1.setAttribute("y", "4"); locker1.setAttribute("width", "16"); locker1.setAttribute("height", "32"); locker1.setAttribute("fill", color); locker1.setAttribute("stroke", darkerColor); locker1.setAttribute("stroke-width", "2"); svg.appendChild(locker1); const locker2 = document.createElementNS(svgNS, "rect"); locker2.setAttribute("x", "20"); locker2.setAttribute("y", "4"); locker2.setAttribute("width", "16"); locker2.setAttribute("height", "32"); locker2.setAttribute("fill", color); locker2.setAttribute("stroke", darkerColor); locker2.setAttribute("stroke-width", "2"); svg.appendChild(locker2);[12, 28].forEach(x => { const vent = document.createElementNS(svgNS, "rect"); vent.setAttribute("x", x - 4); vent.setAttribute("y", "10"); vent.setAttribute("width", "8"); vent.setAttribute("height", "8"); vent.setAttribute("fill", darkerColor); svg.appendChild(vent); const handle = document.createElementNS(svgNS, "circle"); handle.setAttribute("cx", x); handle.setAttribute("cy", "22"); handle.setAttribute("r", "2"); handle.setAttribute("fill", lighterColor); svg.appendChild(handle); }); } else if (type === 'waterTank') { const tank = document.createElementNS(svgNS, "rect"); tank.setAttribute("x", "6"); tank.setAttribute("y", "10"); tank.setAttribute("width", "28"); tank.setAttribute("height", "26"); tank.setAttribute("fill", color); tank.setAttribute("stroke", darkerColor); tank.setAttribute("stroke-width", "2"); svg.appendChild(tank); const water = document.createElementNS(svgNS, "rect"); water.setAttribute("x", "8"); water.setAttribute("y", "20"); water.setAttribute("width", "24"); water.setAttribute("height", "14"); water.setAttribute("fill", "#4A90E2"); water.setAttribute("opacity", "0.6"); svg.appendChild(water); const jug = document.createElementNS(svgNS, "path"); jug.setAttribute("d", "M 26 8 L 26 18 L 32 18 L 32 12 L 30 10 Z"); jug.setAttribute("fill", lighterColor); jug.setAttribute("stroke", darkerColor); jug.setAttribute("stroke-width", "1"); svg.appendChild(jug); } else if (type === 'bathroomSink') { const basin = document.createElementNS(svgNS, "ellipse"); basin.setAttribute("cx", "20"); basin.setAttribute("cy", "24"); basin.setAttribute("rx", "14"); basin.setAttribute("ry", "10"); basin.setAttribute("fill", color); basin.setAttribute("stroke", darkerColor); basin.setAttribute("stroke-width", "2"); svg.appendChild(basin); const innerBasin = document.createElementNS(svgNS, "ellipse"); innerBasin.setAttribute("cx", "20"); innerBasin.setAttribute("cy", "24"); innerBasin.setAttribute("rx", "10"); innerBasin.setAttribute("ry", "7"); innerBasin.setAttribute("fill", lighterColor); svg.appendChild(innerBasin); const faucet = document.createElementNS(svgNS, "path"); faucet.setAttribute("d", "M 20 10 L 20 18 L 25 18"); faucet.setAttribute("stroke", "#888"); faucet.setAttribute("stroke-width", "3"); faucet.setAttribute("fill", "none"); svg.appendChild(faucet); } else if (type === 'bathroomCounter') { const counter = document.createElementNS(svgNS, "rect"); counter.setAttribute("x", "4"); counter.setAttribute("y", "16"); counter.setAttribute("width", "32"); counter.setAttribute("height", "18"); counter.setAttribute("fill", color); counter.setAttribute("stroke", darkerColor); counter.setAttribute("stroke-width", "2"); svg.appendChild(counter); const basin = document.createElementNS(svgNS, "ellipse"); basin.setAttribute("cx", "20"); basin.setAttribute("cy", "22"); basin.setAttribute("rx", "8"); basin.setAttribute("ry", "6"); basin.setAttribute("fill", "#E8E8E8"); basin.setAttribute("stroke", darkerColor); basin.setAttribute("stroke-width", "1"); svg.appendChild(basin); } else if (type === 'toilet') { const bowl = document.createElementNS(svgNS, "ellipse"); bowl.setAttribute("cx", "20"); bowl.setAttribute("cy", "26"); bowl.setAttribute("rx", "10"); bowl.setAttribute("ry", "8"); bowl.setAttribute("fill", color); bowl.setAttribute("stroke", darkerColor); bowl.setAttribute("stroke-width", "2"); svg.appendChild(bowl); const tank = document.createElementNS(svgNS, "rect"); tank.setAttribute("x", "14"); tank.setAttribute("y", "10"); tank.setAttribute("width", "12"); tank.setAttribute("height", "14"); tank.setAttribute("fill", color); tank.setAttribute("stroke", darkerColor); tank.setAttribute("stroke-width", "2"); tank.setAttribute("rx", "2"); svg.appendChild(tank); const lid = document.createElementNS(svgNS, "ellipse"); lid.setAttribute("cx", "20"); lid.setAttribute("cy", "24"); lid.setAttribute("rx", "8"); lid.setAttribute("ry", "6"); lid.setAttribute("fill", lighterColor); lid.setAttribute("stroke", darkerColor); lid.setAttribute("stroke-width", "1"); svg.appendChild(lid); } else if (type === 'stallWall') { const wall = document.createElementNS(svgNS, "rect"); wall.setAttribute("x", "2"); wall.setAttribute("y", "2"); wall.setAttribute("width", "36"); wall.setAttribute("height", "36"); wall.setAttribute("fill", color); wall.setAttribute("stroke", darkerColor); wall.setAttribute("stroke-width", "2"); svg.appendChild(wall); const gap = document.createElementNS(svgNS, "rect"); gap.setAttribute("x", "2"); gap.setAttribute("y", "30"); gap.setAttribute("width", "36"); gap.setAttribute("height", "8"); gap.setAttribute("fill", "none"); svg.appendChild(gap); } else if (type === 'shower') { const base = document.createElementNS(svgNS, "rect"); base.setAttribute("x", "8"); base.setAttribute("y", "28"); base.setAttribute("width", "24"); base.setAttribute("height", "8"); base.setAttribute("fill", lighterColor); base.setAttribute("stroke", darkerColor); base.setAttribute("stroke-width", "2"); svg.appendChild(base); const pipe = document.createElementNS(svgNS, "rect"); pipe.setAttribute("x", "18"); pipe.setAttribute("y", "6"); pipe.setAttribute("width", "4"); pipe.setAttribute("height", "22"); pipe.setAttribute("fill", color); svg.appendChild(pipe); const head = document.createElementNS(svgNS, "rect"); head.setAttribute("x", "12"); head.setAttribute("y", "4"); head.setAttribute("width", "16"); head.setAttribute("height", "4"); head.setAttribute("fill", color); head.setAttribute("stroke", darkerColor); head.setAttribute("stroke-width", "1"); svg.appendChild(head); for (let i = 0; i < 8; i++) { const drop = document.createElementNS(svgNS, "line"); drop.setAttribute("x1", 14 + i * 2); drop.setAttribute("y1", "8"); drop.setAttribute("x2", 14 + i * 2); drop.setAttribute("y2", "12"); drop.setAttribute("stroke", "#4A90E2"); drop.setAttribute("stroke-width", "1"); drop.setAttribute("opacity", "0.6"); svg.appendChild(drop); } } return svg; } const WALL_TYPES = { standard: { name: 'Standard Wall', color: '#E6E0D2' }, picketFence: { name: 'Picket Fence', color: '#c1c1af' }, woodenFence: { name: 'Wooden Fence', color: '#553b24' }, logWall: { name: 'Log Wall', color: '#463827' } }; const DOOR_TYPES = { standard: { name: 'Standard Door', color: '#8B6A45' }, logGate: { name: 'Log Gate', color: '#463827' } }; const ROWS = 40; const COLS = 50; let currentMode = 'floor'; let currentMaterial = 'sand'; let currentFurniture = 'bed'; let currentWallType = 'standard'; let currentDoorType = 'standard'; let currentRotation = 0; let blueprintData = []; let zoomLevel = 1; let uiVisible = true; let roomDrawing = false; let roomStartRow = null; let roomStartCol = null; let roomPreview = null; const defaultConfig = { project_title: 'My Blueprint', background_color: '#1a1a1a', grid_color: '#333', text_color: '#f3f4f6', button_color: '#4b5563', font_family: 'Inter, system-ui, sans-serif', font_size: 16 }; function initializeGrid() {
            const grid = document.getElementById('grid'); grid.innerHTML = ''; for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    const tile = document.createElement('div'); tile.className = 'tile'; tile.dataset.row = row; tile.dataset.col = col; tile.style.background = '#1a1a1a'; tile.addEventListener('click', (e) => handleTileClick(row, col, e)); tile.addEventListener('mousedown', (e) => handleTileMouseDown(row, col, e)); tile.addEventListener('mouseenter', (e) => handleTileMouseEnter(row, col, e)); // Only add top and left edges to avoid duplicates // Top edge for row 0, and left edge for col 0 are the boundaries if (row === 0 || col > 0) { const topEdge = document.createElement('div'); topEdge.className = 'edge-button edge-top'; topEdge.dataset.side = 'top'; topEdge.addEventListener('click', (e) => { e.stopPropagation(); handleEdgeClick(row, col, 'top'); }); tile.appendChild(topEdge); } if (col === 0 || row > 0) { const leftEdge = document.createElement('div'); leftEdge.className = 'edge-button edge-left'; leftEdge.dataset.side = 'left'; leftEdge.addEventListener('click', (e) => { e.stopPropagation(); handleEdgeClick(row, col, 'left'); }); tile.appendChild(leftEdge); } grid.appendChild(tile); } } } async function handleTileClick(row, col, e) { if (currentMode === 'rooms') { return; } if (currentMode === 'erase') { await eraseFurniture(row, col); await eraseFloorTile(row, col); } else if (currentMode === 'floor') { await addFloorTile(row, col); } else if (currentMode === 'furniture') { await addFurniture(row, col); } } function handleTileMouseDown(row, col, e) { if (currentMode !== 'rooms') return; e.preventDefault(); roomDrawing = true; roomStartRow = row; roomStartCol = col; updateRoomPreview(row, col); } function handleTileMouseEnter(row, col, e) { if (currentMode !== 'rooms' || !roomDrawing) return; updateRoomPreview(row, col); } async function handleTileMouseUp(row, col, e) { if (currentMode !== 'rooms' || !roomDrawing) return; e.preventDefault(); roomDrawing = false; if (roomPreview) { roomPreview.remove(); roomPreview = null; } const minRow = Math.min(roomStartRow, row); const maxRow = Math.max(roomStartRow, row); const minCol = Math.min(roomStartCol, col); const maxCol = Math.max(roomStartCol, col); if (minRow === maxRow && minCol === maxCol) { roomStartRow = null; roomStartCol = null; return; } await createRoom(minRow, maxRow, minCol, maxCol); roomStartRow = null; roomStartCol = null; } function updateRoomPreview(currentRow, currentCol) { if (!roomPreview) { roomPreview = document.createElement('div'); roomPreview.className = 'room-preview'; document.getElementById('grid').appendChild(roomPreview); } const minRow = Math.min(roomStartRow, currentRow); const maxRow = Math.max(roomStartRow, currentRow); const minCol = Math.min(roomStartCol, currentCol); const maxCol = Math.max(roomStartCol, currentCol); const width = (maxCol - minCol + 1) * 40; const height = (maxRow - minRow + 1) * 40; roomPreview.style.left = `${minCol * 40}px`; roomPreview.style.top = `${minRow * 40}px`; roomPreview.style.width = `${width}px`; roomPreview.style.height = `${height}px`; } async function createRoom(minRow, maxRow, minCol, maxCol) { const wallColor = WALL_TYPES[currentWallType].color; for (let col = minCol; col <= maxCol; col++) { const topWallExists = blueprintData.some(item => item.type === 'wall' && item.row === minRow && item.col === col && item.side === 'top' ); if (!topWallExists && blueprintData.length < 999) { await window.dataSdk.create({ type: 'wall', row: minRow, col: col, side: 'top', color: wallColor, furnitureType: currentWallType, rotation: 0 }); } const bottomWallExists = blueprintData.some(item => item.type === 'wall' && item.row === maxRow && item.col === col && item.side === 'bottom' ); if (!bottomWallExists && blueprintData.length < 999) { await window.dataSdk.create({ type: 'wall', row: maxRow, col: col, side: 'bottom', color: wallColor, furnitureType: currentWallType, rotation: 0 }); } } for (let row = minRow; row <= maxRow; row++) { const leftWallExists = blueprintData.some(item => item.type === 'wall' && item.row === row && item.col === minCol && item.side === 'left' ); if (!leftWallExists && blueprintData.length < 999) { await window.dataSdk.create({ type: 'wall', row: row, col: minCol, side: 'left', color: wallColor, furnitureType: currentWallType, rotation: 0 }); } const rightWallExists = blueprintData.some(item => item.type === 'wall' && item.row === row && item.col === maxCol && item.side === 'right' ); if (!rightWallExists && blueprintData.length < 999) { await window.dataSdk.create({ type: 'wall', row: row, col: maxCol, side: 'right', color: wallColor, furnitureType: currentWallType, rotation: 0 }); } } showMessage('Room created!'); } async function handleEdgeClick(row, col, side) { if (currentMode === 'erase') { await eraseEdge(row, col, side); } else if (currentMode === 'wall') { await addWall(row, col, side); } else if (currentMode === 'door') { await addDoor(row, col, side); } else if (currentMode === 'furniture') { await addWallShelf(row, col, side); } } function hasWall(row, col, side) { return blueprintData.some(item => item.type === 'wall' && item.row === row && item.col === col && item.side === side ); } function isTileOccupied(row, col) { return blueprintData.some(item => item.type === 'furniture' && item.row === row && item.col === col ); } function canPlaceFurniture(row, col, furniture, rotation) { let [width, height] = furniture.size; if (rotation === 90 || rotation === 270) { [width, height] = [height, width]; } if (row + height > ROWS || col + width > COLS) { return false; } for (let r = row; r < row + height; r++) { for (let c = col; c < col + width; c++) { if (isTileOccupied(r, c)) { return false; } } } if (furniture.wallMount === true) { const hasAdjacentWall = ( hasWall(row, col, 'top') || hasWall(row, col, 'bottom') || hasWall(row, col, 'left') || hasWall(row, col, 'right') ); return hasAdjacentWall; } return true; } async function addFurniture(row, col) { const furniture = FURNITURE[currentFurniture]; if (furniture.wallMount === 'wall-only') { showMessage('Wall shelves must be placed on edges'); return; } if (!canPlaceFurniture(row, col, furniture, currentRotation)) { showMessage('Cannot place furniture here'); return; } let [width, height] = furniture.size; if (currentRotation === 90 || currentRotation === 270) { [width, height] = [height, width]; } for (let r = row; r < row + height; r++) { for (let c = col; c < col + width; c++) { if (blueprintData.length >= 999) { showMessage('Maximum limit reached'); return; } const result = await window.dataSdk.create({ type: 'furniture', row: r, col: c, side: '', color: furniture.color, furnitureType: currentFurniture, rotation: currentRotation }); if (!result.isOk) { showMessage('Failed to place furniture'); return; } } } } async function addWallShelf(row, col, side) { if (currentFurniture !== 'wallShelf') { return; } if (!hasWall(row, col, side)) { showMessage('Wall shelves must be placed on walls'); return; } const existing = blueprintData.find(item => item.type === 'wallShelf' && item.row === row && item.col === col && item.side === side ); if (existing) { return; } if (blueprintData.length >= 999) { showMessage('Maximum limit reached'); return; } const result = await window.dataSdk.create({ type: 'wallShelf', row: row, col: col, side: side, color: FURNITURE.wallShelf.color, furnitureType: 'wallShelf', rotation: 0 }); if (!result.isOk) { showMessage('Failed to place shelf'); } } async function eraseFurniture(row, col) { const furniture = blueprintData.filter(item => item.type === 'furniture' && item.row === row && item.col === col ); for (const item of furniture) { const furnitureType = item.furnitureType; const relatedItems = blueprintData.filter(i => i.type === 'furniture' && i.furnitureType === furnitureType && Math.abs(i.row - item.row) <= 1 && Math.abs(i.col - item.col) <= 1 ); for (const related of relatedItems) { await window.dataSdk.delete(related); } } } async function addFloorTile(row, col) { const existing = blueprintData.find(item => item.type === 'floor' && item.row === row && item.col === col ); let tileColor = MATERIALS[currentMaterial]; if (currentMaterial === 'brick') { const isAlternate = (row + col) % 2 === 0; tileColor = isAlternate ? '#73574b' : '#84675c'; } if (existing) { if (existing.color === tileColor) { const result = await window.dataSdk.delete(existing); if (!result.isOk) { showMessage('Failed to delete tile'); } } else { const updated = { ...existing, color: tileColor }; const result = await window.dataSdk.update(updated); if (!result.isOk) { showMessage('Failed to update tile'); } } } else { if (blueprintData.length >= 999) { showMessage('Maximum limit reached'); return; } const result = await window.dataSdk.create({ type: 'floor', row: row, col: col, side: '', color: tileColor, furnitureType: '', rotation: 0 }); if (!result.isOk) { showMessage('Failed to add tile'); } } } async function eraseFloorTile(row, col) { const existing = blueprintData.find(item => item.type === 'floor' && item.row === row && item.col === col ); if (existing) { const result = await window.dataSdk.delete(existing); if (!result.isOk) { showMessage('Failed to erase tile'); } } } async function addWall(row, col, side) { const existing = blueprintData.find(item => item.row === row && item.col === col && item.side === side ); if (existing && existing.type === 'wall') { const result = await window.dataSdk.delete(existing); if (!result.isOk) { showMessage('Failed to delete wall'); } return; } if (existing) { await window.dataSdk.delete(existing); } if (blueprintData.length >= 999) { showMessage('Maximum limit reached'); return; } const wallColor = WALL_TYPES[currentWallType].color; const result = await window.dataSdk.create({ type: 'wall', row: row, col: col, side: side, color: wallColor, furnitureType: currentWallType, rotation: 0 }); if (!result.isOk) { showMessage('Failed to add wall'); } } async function addDoor(row, col, side) { const existing = blueprintData.find(item => item.row === row && item.col === col && item.side === side ); if (existing && existing.type === 'door') { const result = await window.dataSdk.delete(existing); if (!result.isOk) { showMessage('Failed to delete door'); } return; } if (existing) { await window.dataSdk.delete(existing); } if (blueprintData.length >= 999) { showMessage('Maximum limit reached'); return; } const doorColor = DOOR_TYPES[currentDoorType].color; const result = await window.dataSdk.create({ type: 'door', row: row, col: col, side: side, color: doorColor, furnitureType: currentDoorType, rotation: 0 }); if (!result.isOk) { showMessage('Failed to add door'); } } async function eraseEdge(row, col, side) { const existing = blueprintData.filter(item => item.row === row && item.col === col && item.side === side ); for (const item of existing) { const result = await window.dataSdk.delete(item); if (!result.isOk) { showMessage('Failed to erase'); } } } function renderBlueprint(data) { blueprintData = data; document.querySelectorAll('.wall-overlay, .door-overlay, .furniture-overlay, .wall-shelf-overlay').forEach(el => el.remove()); document.querySelectorAll('.tile').forEach(tile => { tile.style.background = '#1a1a1a'; tile.style.boxShadow = ''; }); const furnitureGroups = new Map(); const floorTiles = data.filter(item => item.type === 'floor'); const wallCorners = new Set(); data.forEach(item => { if (item.type === 'wall') { const row = parseInt(item.row); const col = parseInt(item.col); if (item.side === 'top' || item.side === 'bottom') { wallCorners.add(`${row},${col},left`); wallCorners.add(`${row},${col},right`); } else { wallCorners.add(`${row},${col},top`); wallCorners.add(`${row},${col},bottom`); } } }); data.forEach(item => { if (item.type === 'floor') { const tile = document.querySelector(`[data-row="${item.row}"][data-col="${item.col}"]`); if (tile) { let materialType = 'sand'; for (const [key, color] of Object.entries(MATERIALS)) { if (item.color === color || (key === 'brick' && (item.color === '#73574b' || item.color === '#84675c'))) { materialType = key; break; } } const texture = createFloorTexture(materialType, item.row, item.col); tile.style.background = `url(${texture})`; tile.style.backgroundColor = item.color; const row = parseInt(item.row); const col = parseInt(item.col); const hasWallTop = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'top'); const hasWallBottom = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'bottom'); const hasWallLeft = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'left'); const hasWallRight = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'right'); const hasDoorTop = data.some(d => d.type === 'door' && d.row === row && d.col === col && d.side === 'top'); const hasDoorBottom = data.some(d => d.type === 'door' && d.row === row && d.col === col && d.side === 'bottom'); const hasDoorLeft = data.some(d => d.type === 'door' && d.row === row && d.col === col && d.side === 'left'); const hasDoorRight = data.some(d => d.type === 'door' && d.row === row && d.col === col && d.side === 'right'); const neighborTop = floorTiles.find(d => d.row === row - 1 && d.col === col); const neighborBottom = floorTiles.find(d => d.row === row + 1 && d.col === col); const neighborLeft = floorTiles.find(d => d.row === row && d.col === col - 1); const neighborRight = floorTiles.find(d => d.row === row && d.col === col + 1); let shadows = []; if (neighborTop && neighborTop.color !== item.color && !hasWallTop && !hasDoorTop) { shadows.push('inset 0 15px 20px -10px rgba(0,0,0,0.5)'); } if (neighborBottom && neighborBottom.color !== item.color && !hasWallBottom && !hasDoorBottom) { shadows.push('inset 0 -15px 20px -10px rgba(0,0,0,0.5)'); } if (neighborLeft && neighborLeft.color !== item.color && !hasWallLeft && !hasDoorLeft) { shadows.push('inset 15px 0 20px -10px rgba(0,0,0,0.5)'); } if (neighborRight && neighborRight.color !== item.color && !hasWallRight && !hasDoorRight) { shadows.push('inset -15px 0 20px -10px rgba(0,0,0,0.5)'); } if (shadows.length > 0) { tile.style.boxShadow = shadows.join(', '); } } } else if (item.type === 'wall') { const tile = document.querySelector(`[data-row="${item.row}"][data-col="${item.col}"]`); if (tile) { const overlay = document.createElement('div'); overlay.className = `${item.type}-overlay ${item.type}-${item.side}`; overlay.style.background = item.color; tile.appendChild(overlay); } } else if (item.type === 'door') { const tile = document.querySelector(`[data-row="${item.row}"][data-col="${item.col}"]`); if (tile) { const overlay = document.createElement('div'); overlay.className = `${item.type}-overlay ${item.type}-${item.side}`; overlay.style.background = item.color; tile.appendChild(overlay); } } else if (item.type === 'furniture') { const key = `${item.furnitureType}-${item.rotation}`; if (!furnitureGroups.has(key)) { furnitureGroups.set(key, []); } furnitureGroups.get(key).push(item); } else if (item.type === 'wallShelf') { const tile = document.querySelector(`[data-row="${item.row}"][data-col="${item.col}"]`); if (tile) { const overlay = document.createElement('div'); overlay.className = 'wall-shelf-overlay'; overlay.style.background = item.color; overlay.style.border = '1px solid rgba(0,0,0,0.4)'; if (item.side === 'top') { overlay.style.top = '-12px'; overlay.style.left = '0'; overlay.style.width = '100%'; overlay.style.height = '12px'; } else if (item.side === 'bottom') { overlay.style.bottom = '-12px'; overlay.style.left = '0'; overlay.style.width = '100%'; overlay.style.height = '12px'; } else if (item.side === 'left') { overlay.style.left = '-12px'; overlay.style.top = '0'; overlay.style.width = '12px'; overlay.style.height = '100%'; } else if (item.side === 'right') { overlay.style.right = '-12px'; overlay.style.top = '0'; overlay.style.width = '12px'; overlay.style.height = '100%'; } tile.appendChild(overlay); } } }); // Fill corner gaps where walls meet const wallData = data.filter(item => item.type === 'wall'); const processedCorners = new Set(); wallData.forEach(wall => { const row = parseInt(wall.row); const col = parseInt(wall.col); const tile = document.querySelector(`[data-row="${row}"][data-col="${col}"]`); if (!tile) return; // Check all four corners of this tile // Top-left corner if (wall.side === 'top' || wall.side === 'left') { const hasTop = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'top'); const hasLeft = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'left'); if (hasTop && hasLeft) { const cornerKey = `${row},${col},tl`; if (!processedCorners.has(cornerKey)) { const corner = document.createElement('div'); corner.className = 'wall-corner'; corner.style.background = wall.color; corner.style.top = '-1.5px'; corner.style.left = '-1.5px'; tile.appendChild(corner); processedCorners.add(cornerKey); } } } // Top-right corner if (wall.side === 'top' || wall.side === 'right') { const hasTop = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'top'); const hasRight = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'right'); if (hasTop && hasRight) { const cornerKey = `${row},${col},tr`; if (!processedCorners.has(cornerKey)) { const corner = document.createElement('div'); corner.className = 'wall-corner'; corner.style.background = wall.color; corner.style.top = '-1.5px'; corner.style.right = '-1.5px'; tile.appendChild(corner); processedCorners.add(cornerKey); } } } // Bottom-left corner if (wall.side === 'bottom' || wall.side === 'left') { const hasBottom = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'bottom'); const hasLeft = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'left'); if (hasBottom && hasLeft) { const cornerKey = `${row},${col},bl`; if (!processedCorners.has(cornerKey)) { const corner = document.createElement('div'); corner.className = 'wall-corner'; corner.style.background = wall.color; corner.style.bottom = '-1.5px'; corner.style.left = '-1.5px'; tile.appendChild(corner); processedCorners.add(cornerKey); } } } // Bottom-right corner if (wall.side === 'bottom' || wall.side === 'right') { const hasBottom = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'bottom'); const hasRight = data.some(d => d.type === 'wall' && d.row === row && d.col === col && d.side === 'right'); if (hasBottom && hasRight) { const cornerKey = `${row},${col},br`; if (!processedCorners.has(cornerKey)) { const corner = document.createElement('div'); corner.className = 'wall-corner'; corner.style.background = wall.color; corner.style.bottom = '-1.5px'; corner.style.right = '-1.5px'; tile.appendChild(corner); processedCorners.add(cornerKey); } } } }); furnitureGroups.forEach((items, key) => { const furnitureType = items[0].furnitureType; const rotation = items[0].rotation; const furniture = FURNITURE[furnitureType]; if (!furniture) return; items.sort((a, b) => a.row !== b.row ? a.row - b.row : a.col - b.col); const firstItem = items[0]; let [width, height] = furniture.size; if (rotation === 90 || rotation === 270) { [width, height] = [height, width]; } const tile = document.querySelector(`[data-row="${firstItem.row}"][data-col="${firstItem.col}"]`); if (tile) { const overlay = document.createElement('div'); overlay.className = 'furniture-overlay'; if (furniture.within) { overlay.classList.add('furniture-within'); } overlay.style.background = furniture.color; overlay.style.width = `${width * 40}px`; overlay.style.height = `${height * 40}px`; const svg = createFurnitureSVG(furnitureType, width, height, furniture.color); svg.classList.add('furniture-svg'); let transform = ''; if (rotation === 90) transform = 'rotate(90deg)'; else if (rotation === 180) transform = 'rotate(180deg)'; else if (rotation === 270) transform = 'rotate(270deg)'; if (transform) { svg.style.transform = transform; svg.style.transformOrigin = 'center'; } overlay.appendChild(svg); tile.appendChild(overlay); } }); } function showMessage(msg) { const existing = document.getElementById('toast-message'); if (existing) existing.remove(); const toast = document.createElement('div'); toast.id = 'toast-message'; toast.textContent = msg; toast.style.cssText = ` position: fixed; top: 20px; right: 20px; background: #333; color: white; padding: 12px 24px; border-radius: 6px; z-index: 1000; `; document.body.appendChild(toast); setTimeout(() => toast.remove(), 3000); } function updateRotationButton() { const btn = document.getElementById('rotate-btn'); const rotations = [ { deg: 0, label: '⬆����� North' }, { deg: 90, label: '➡️ East' }, { deg: 180, label: '⬇️ South' }, { deg: 270, label: '⬅️ West' } ]; const current = rotations.find(r => r.deg === currentRotation); btn.textContent = current.label; } function updateSelectedInfo() { const nameEl = document.getElementById('selected-name'); if (currentMode === 'furniture') { const furniture = FURNITURE[currentFurniture]; nameEl.textContent = furniture.name; } else if (currentMode === 'floor') { const materialName = currentMaterial === 'concreteBlock' ? 'Concrete Block' : currentMaterial === 'parkingLot' ? 'Parking Lot' : currentMaterial.charAt(0).toUpperCase() + currentMaterial.slice(1); nameEl.textContent = `${materialName} Floor`; } else if (currentMode === 'wall') { const wallType = WALL_TYPES[currentWallType]; nameEl.textContent = wallType.name; } else if (currentMode === 'door') { const doorType = DOOR_TYPES[currentDoorType]; nameEl.textContent = doorType.name; } else if (currentMode === 'rooms') { const wallType = WALL_TYPES[currentWallType]; nameEl.textContent = `Room (${wallType.name})`; } else if (currentMode === 'erase') { nameEl.textContent = 'Eraser'; } } document.getElementById('rotate-btn').addEventListener('click', () => { currentRotation = (currentRotation + 90) % 360; updateRotationButton(); }); function updateEdgeVisibility() { const showEdges = currentMode === 'wall' || currentMode === 'door' || currentMode === 'erase'; document.querySelectorAll('.edge-button').forEach(edge => { if (showEdges) { edge.classList.add('visible'); } else { edge.classList.remove('visible'); } }); } document.getElementById('mode-floor').addEventListener('click', () => { currentMode = 'floor'; document.querySelectorAll('[id^="mode-"]').forEach(btn => btn.classList.remove('active')); document.getElementById('mode-floor').classList.add('active'); document.getElementById('material-section').style.display = 'block'; document.getElementById('furniture-section').style.display = 'none'; document.getElementById('wall-section').style.display = 'none'; document.getElementById('door-section').style.display = 'none'; updateSelectedInfo(); updateEdgeVisibility(); }); document.getElementById('mode-wall').addEventListener('click', () => { currentMode = 'wall'; document.querySelectorAll('[id^="mode-"]').forEach(btn => btn.classList.remove('active')); document.getElementById('mode-wall').classList.add('active'); document.getElementById('material-section').style.display = 'none'; document.getElementById('furniture-section').style.display = 'none'; document.getElementById('wall-section').style.display = 'block'; document.getElementById('door-section').style.display = 'none'; updateSelectedInfo(); updateEdgeVisibility(); }); document.getElementById('mode-door').addEventListener('click', () => { currentMode = 'door'; document.querySelectorAll('[id^="mode-"]').forEach(btn => btn.classList.remove('active')); document.getElementById('mode-door').classList.add('active'); document.getElementById('material-section').style.display = 'none'; document.getElementById('furniture-section').style.display = 'none'; document.getElementById('wall-section').style.display = 'none'; document.getElementById('door-section').style.display = 'block'; updateSelectedInfo(); updateEdgeVisibility(); }); document.getElementById('mode-furniture').addEventListener('click', () => { currentMode = 'furniture'; document.querySelectorAll('[id^="mode-"]').forEach(btn => btn.classList.remove('active')); document.getElementById('mode-furniture').classList.add('active'); document.getElementById('material-section').style.display = 'none'; document.getElementById('furniture-section').style.display = 'block'; document.getElementById('wall-section').style.display = 'none'; document.getElementById('door-section').style.display = 'none'; updateSelectedInfo(); updateEdgeVisibility(); }); document.getElementById('mode-rooms').addEventListener('click', () => { currentMode = 'rooms'; document.querySelectorAll('[id^="mode-"]').forEach(btn => btn.classList.remove('active')); document.getElementById('mode-rooms').classList.add('active'); document.getElementById('material-section').style.display = 'none'; document.getElementById('furniture-section').style.display = 'none'; document.getElementById('wall-section').style.display = 'block'; document.getElementById('door-section').style.display = 'none'; updateSelectedInfo(); updateEdgeVisibility(); }); document.getElementById('mode-erase').addEventListener('click', () => { currentMode = 'erase'; document.querySelectorAll('[id^="mode-"]').forEach(btn => btn.classList.remove('active')); document.getElementById('mode-erase').classList.add('active'); document.getElementById('material-section').style.display = 'none'; document.getElementById('furniture-section').style.display = 'none'; document.getElementById('wall-section').style.display = 'none'; document.getElementById('door-section').style.display = 'none'; updateSelectedInfo(); updateEdgeVisibility(); }); document.querySelectorAll('[data-material]').forEach(btn => { btn.addEventListener('click', () => { currentMaterial = btn.dataset.material; document.querySelectorAll('[data-material]').forEach(b => b.classList.remove('active')); btn.classList.add('active'); updateSelectedInfo(); }); }); document.querySelectorAll('[data-furniture]').forEach(btn => { btn.addEventListener('click', () => { currentFurniture = btn.dataset.furniture; document.querySelectorAll('[data-furniture]').forEach(b => b.classList.remove('active')); btn.classList.add('active'); updateSelectedInfo(); }); }); document.querySelectorAll('[data-wall]').forEach(btn => { btn.addEventListener('click', () => { currentWallType = btn.dataset.wall; document.querySelectorAll('[data-wall]').forEach(b => b.classList.remove('active')); btn.classList.add('active'); updateSelectedInfo(); }); }); document.querySelectorAll('[data-door]').forEach(btn => { btn.addEventListener('click', () => { currentDoorType = btn.dataset.door; document.querySelectorAll('[data-door]').forEach(b => b.classList.remove('active')); btn.classList.add('active'); updateSelectedInfo(); }); }); function setZoom(newZoom) { zoomLevel = Math.max(0.25, Math.min(3, newZoom)); const wrapper = document.getElementById('grid-wrapper'); wrapper.style.transform = `scale(${zoomLevel})`; document.getElementById('zoom-reset').textContent = `${Math.round(zoomLevel * 100)}%`; } document.getElementById('zoom-in').addEventListener('click', () => { setZoom(zoomLevel + 0.25); }); document.getElementById('zoom-out').addEventListener('click', () => { setZoom(zoomLevel - 0.25); }); document.getElementById('zoom-reset').addEventListener('click', () => { setZoom(1); }); document.getElementById('grid-viewport').addEventListener('wheel', (e) => { if (e.ctrlKey || e.metaKey) { e.preventDefault(); const delta = e.deltaY > 0 ? -0.1 : 0.1; setZoom(zoomLevel + delta); } }, { passive: false }); document.getElementById('toggle-ui').addEventListener('click', () => { uiVisible = !uiVisible; const sidebar = document.querySelector('.w-56'); const legend = document.querySelector('.w-48'); const header = document.querySelector('.bg-gray-800.border-b'); if (uiVisible) { sidebar.style.display = 'block'; legend.style.display = 'block'; header.style.display = 'flex'; } else { sidebar.style.display = 'none'; legend.style.display = 'none'; header.style.display = 'none'; } }); document.getElementById('clear-all').addEventListener('click', async () => { const confirmDiv = document.createElement('div'); confirmDiv.style.cssText = ` position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 24px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); z-index: 1000; text-align: center; `; confirmDiv.innerHTML = ` <p style="margin-bottom: 16px; font-weight: bold;">Clear entire blueprint?</p> <button id="confirm-yes" style="padding: 8px 16px; margin: 0 8px; background: #c62828; color: white; border: none; border-radius: 4px; cursor: pointer;">Yes, Clear</button> <button id="confirm-no" style="padding: 8px 16px; margin: 0 8px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button> `; const backdrop = document.createElement('div'); backdrop.style.cssText = ` position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999; `; document.body.appendChild(backdrop); document.body.appendChild(confirmDiv); document.getElementById('confirm-yes').addEventListener('click', async () => { for (const item of blueprintData) { await window.dataSdk.delete(item); } backdrop.remove(); confirmDiv.remove(); showMessage('Blueprint cleared'); }); document.getElementById('confirm-no').addEventListener('click', () => { backdrop.remove(); confirmDiv.remove(); }); }); const dataHandler = { onDataChanged(data) { renderBlueprint(data); } }; async function onConfigChange(config) { const titleElement = document.getElementById('project-title'); titleElement.textContent = config.project_title || defaultConfig.project_title; titleElement.style.fontFamily = `${config.font_family || defaultConfig.font_family}, system-ui, sans-serif`; titleElement.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.5}px`; titleElement.style.color = config.text_color || defaultConfig.text_color; document.querySelector('.grid-container').style.background = config.background_color || defaultConfig.background_color; document.querySelectorAll('.tile').forEach(tile => { tile.style.borderColor = config.grid_color || defaultConfig.grid_color; }); } const capabilities = { recolorables: [ { get: () => window.elementSdk?.config?.background_color || defaultConfig.background_color, set: (value) => { if (window.elementSdk) { window.elementSdk.config.background_color = value; window.elementSdk.setConfig({ background_color: value }); } } }, { get: () => window.elementSdk?.config?.grid_color || defaultConfig.grid_color, set: (value) => { if (window.elementSdk) { window.elementSdk.config.grid_color = value; window.elementSdk.setConfig({ grid_color: value }); } } }, { get: () => window.elementSdk?.config?.text_color || defaultConfig.text_color, set: (value) => { if (window.elementSdk) { window.elementSdk.config.text_color = value; window.elementSdk.setConfig({ text_color: value }); } } }, { get: () => window.elementSdk?.config?.button_color || defaultConfig.button_color, set: (value) => { if (window.elementSdk) { window.elementSdk.config.button_color = value; window.elementSdk.setConfig({ button_color: value }); } } } ], borderables: [], fontEditable: { get: () => window.elementSdk?.config?.font_family || defaultConfig.font_family, set: (value) => { if (window.elementSdk) { window.elementSdk.config.font_family = value; window.elementSdk.setConfig({ font_family: value }); } } }, fontSizeable: { get: () => window.elementSdk?.config?.font_size || defaultConfig.font_size, set: (value) => { if (window.elementSdk) { window.elementSdk.config.font_size = value; window.elementSdk.setConfig({ font_size: value }); } } } }; function mapToEditPanelValues(config) { return new Map([ ['project_title', config.project_title || defaultConfig.project_title] ]); } async function init() { initializeGrid(); updateSelectedInfo(); // Add global mouseup handler for room drawing document.addEventListener('mouseup', async (e) => { if (currentMode === 'rooms' && roomDrawing) { // Find which tile the mouse is over const element = document.elementFromPoint(e.clientX, e.clientY); const tile = element?.closest('.tile'); if (tile) { const row = parseInt(tile.dataset.row); const col = parseInt(tile.dataset.col); await handleTileMouseUp(row, col, e); } else { // Mouse released outside grid, cancel drawing roomDrawing = false; if (roomPreview) { roomPreview.remove(); roomPreview = null; } roomStartRow = null; roomStartCol = null; } } }); if (window.elementSdk) { window.elementSdk.init({ defaultConfig, onConfigChange, mapToCapabilities: () => capabilities, mapToEditPanelValues }); } if (window.dataSdk) { const result = await window.dataSdk.init(dataHandler); if (!result.isOk) { showMessage('Failed to initialize data storage'); } } } init(); </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9b016b89861efa34',t:'MTc2NjA4OTg0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>